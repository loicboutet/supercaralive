<% 
  # Day names for date formatting
  day_names = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam']
  month_names = ['jan', 'f√©v', 'mar', 'avr', 'mai', 'jun', 'jul', 'ao√ª', 'sep', 'oct', 'nov', 'd√©c']
%>

<div class="bg-soft min-h-screen">
  <div class="container mx-auto px-6 py-8">
    
    <!-- Welcome Header -->
    <div class="mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-2">
        Bonjour<% if current_user.first_name.present? %>, <span class="text-blue-hero"><%= current_user.first_name %></span><% end %> üëã
      </h1>
      <p class="text-xl text-gray-600">
        G√©rez votre activit√© professionnelle Supercaralive
      </p>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-lg p-6 md:p-8 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="flex flex-col">
            <span class="text-lg font-bold text-gray-700 mb-2">En attente</span>
            <p class="text-4xl md:text-5xl font-bold text-yellow-hero mb-2"><%= @pending_bookings_count %></p>
            <p class="text-base text-gray-500">R√©servations</p>
          </div>
          <div class="w-12 h-12 md:w-16 md:h-16 bg-yellow-hero rounded-lg flex items-center justify-center flex-shrink-0">
            <span class="text-white text-2xl md:text-3xl">‚è≥</span>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg p-6 md:p-8 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="flex flex-col">
            <span class="text-lg font-bold text-gray-700 mb-2">√Ä venir</span>
            <p class="text-4xl md:text-5xl font-bold text-blue-hero mb-2"><%= @upcoming_bookings_count %></p>
            <p class="text-base text-gray-500">Rendez-vous</p>
          </div>
          <div class="w-12 h-12 md:w-16 md:h-16 bg-blue-hero rounded-lg flex items-center justify-center flex-shrink-0">
            <span class="text-white text-2xl md:text-3xl">üìÖ</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid md:grid-cols-3 gap-8">
      
      <!-- Left Column - Pending Bookings -->
      <div class="md:col-span-2 space-y-6">
        
        <!-- Quick Actions -->
        <div class="bg-white rounded-super p-6 shadow-sm">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Actions rapides</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <%= link_to professional_availability_slots_path, class: "bg-blue-hero hover:bg-blue-dark text-white px-6 md:px-8 py-4 rounded-lg font-bold text-base md:text-lg text-center transition flex items-center justify-center space-x-3" do %>
              <span class="text-2xl">üìÖ</span>
              <span>Disponibilit√©s</span>
            <% end %>
            <%= link_to calendar_professional_availability_slots_path, class: "bg-yellow-hero hover:bg-yellow-dark text-white px-6 md:px-8 py-4 rounded-lg font-bold text-base md:text-lg text-center transition flex items-center justify-center space-x-3" do %>
              <span class="text-2xl">üìÜ</span>
              <span>Agenda</span>
            <% end %>
            <%= link_to professional_bookings_path, class: "bg-purple-600 hover:bg-purple-700 text-white px-6 md:px-8 py-4 rounded-lg font-bold text-base md:text-lg text-center transition flex items-center justify-center space-x-3" do %>
              <span class="text-2xl">üìã</span>
              <span>R√©servations</span>
            <% end %>
          </div>
        </div>

        <!-- Pending Bookings -->
        <div class="bg-white rounded-super p-6 shadow-sm">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900">R√©servations en attente</h2>
            <% if @pending_bookings_count > 0 %>
              <%= link_to professional_bookings_path(status: 'pending'), class: "text-blue-hero font-medium hover:underline" do %>
                Voir toutes
              <% end %>
            <% end %>
          </div>

          <% if @pending_bookings.any? %>
            <div class="space-y-4">
              <% @pending_bookings.each do |booking| %>
                <div class="border border-gray-200 rounded-friendly p-4 hover:shadow-md transition">
                  <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 mb-3">
                    <div class="flex items-start space-x-3 flex-1">
                      <div class="w-12 h-12 bg-blue-hero rounded-friendly flex items-center justify-center flex-shrink-0">
                        <% if booking.client&.profile_photo&.attached? %>
                          <%= image_tag booking.client.profile_photo, class: "w-full h-full object-cover rounded-friendly" %>
                        <% else %>
                          <span class="text-white text-xl"><%= booking.client&.get_initials || 'üë§' %></span>
                        <% end %>
                      </div>
                      <div class="flex-1">
                        <h3 class="font-bold text-gray-900"><%= booking.client&.get_full_name || 'Client' %></h3>
                        <p class="text-sm text-gray-600">
                          <%= booking.professional_service.name %>
                          <% if booking.vehicle.present? %>
                            - <%= booking.vehicle.brand %> <%= booking.vehicle.model %>
                          <% end %>
                        </p>
                      </div>
                    </div>
                    <span class="bg-yellow-50 text-yellow-800 px-3 py-1 rounded-friendly text-xs font-medium self-start">
                      En attente
                    </span>
                  </div>
                  <div class="flex flex-wrap items-center text-sm text-gray-600 gap-4">
                    <% if booking.scheduled_at.present? %>
                      <% formatted_date = "#{day_names[booking.scheduled_at.wday]} #{booking.scheduled_at.day} #{month_names[booking.scheduled_at.month - 1]} #{booking.scheduled_at.year}, #{booking.scheduled_at.strftime('%H:%M')}" %>
                      <span>üìÖ <%= formatted_date %></span>
                    <% end %>
                    <% 
                      price_display = if booking.estimated_price.present?
                        sprintf('%.2f', booking.estimated_price)
                      elsif booking.professional_service.pricing_type == 'flat_rate' && booking.professional_service.flat_rate_price.present?
                        sprintf('%.2f', booking.professional_service.flat_rate_price)
                      elsif booking.professional_service.pricing_type == 'hourly_rate' && booking.professional_service.hourly_rate_price.present?
                        "#{sprintf('%.2f', booking.professional_service.hourly_rate_price)}‚Ç¨/h"
                      else
                        "√Ä d√©finir"
                      end
                    %>
                    <span>üí∞ ‚Ç¨<%= price_display %></span>
                  </div>
                  <div class="mt-3 flex flex-col sm:flex-row gap-2">
                    <%= button_to accept_professional_booking_path(booking), method: :patch, 
                        data: { turbo: false },
                        class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition w-full sm:w-auto" do %>
                      ‚úì Accepter
                    <% end %>
                    <%= button_to refuse_professional_booking_path(booking), method: :patch, 
                        data: { turbo: false },
                        class: "bg-red-100 hover:bg-red-200 text-red-800 px-4 py-2 rounded-lg text-sm font-medium transition w-full sm:w-auto" do %>
                      ‚úó Refuser
                    <% end %>
                    <%= link_to professional_booking_path(booking), class: "text-blue-hero font-medium hover:underline text-sm text-center sm:text-left" do %>
                      Voir d√©tails ‚Üí
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-8">
              <p class="text-gray-500">Aucune r√©servation en attente</p>
            </div>
          <% end %>
        </div>

        <!-- Upcoming Confirmed Bookings -->
        <div class="bg-white rounded-super p-6 shadow-sm">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900">Rendez-vous confirm√©s</h2>
            <% if @upcoming_bookings_count > 0 %>
              <%= link_to professional_bookings_path(status: 'accepted'), class: "text-blue-hero font-medium hover:underline" do %>
                Tout voir
              <% end %>
            <% end %>
          </div>

          <% if @upcoming_confirmed_bookings.any? %>
            <div class="space-y-4">
              <% @upcoming_confirmed_bookings.each do |booking| %>
                <div class="flex items-start space-x-3 <%= booking != @upcoming_confirmed_bookings.last ? 'pb-4 border-b border-gray-100' : '' %>">
                  <div class="w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
                  <div class="flex-1">
                    <p class="text-gray-900 font-medium">
                      <%= booking.client&.get_full_name || 'Client' %> - <%= booking.professional_service.name %>
                    </p>
                    <p class="text-sm text-gray-600">
                      <% if booking.scheduled_at.present? %>
                        <% formatted_date = "#{day_names[booking.scheduled_at.wday]} #{booking.scheduled_at.day} #{month_names[booking.scheduled_at.month - 1]} #{booking.scheduled_at.year}, #{booking.scheduled_at.strftime('%H:%M')}" %>
                        üìÖ <%= formatted_date %>
                      <% end %>
                      <% 
                        price_display = if booking.estimated_price.present?
                          sprintf('%.2f', booking.estimated_price)
                        elsif booking.professional_service.pricing_type == 'flat_rate' && booking.professional_service.flat_rate_price.present?
                          sprintf('%.2f', booking.professional_service.flat_rate_price)
                        elsif booking.professional_service.pricing_type == 'hourly_rate' && booking.professional_service.hourly_rate_price.present?
                          "#{sprintf('%.2f', booking.professional_service.hourly_rate_price)}‚Ç¨/h"
                        else
                          "√Ä d√©finir"
                        end
                      %>
                      ‚Ä¢ üí∞ ‚Ç¨<%= price_display %>
                    </p>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-8">
              <p class="text-gray-500">Aucun rendez-vous confirm√© √† venir</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Right Column - Sidebar -->
      <div class="space-y-6">
        
        <!-- Recent Reviews - Hidden -->
        <% if false %>
        <div class="bg-white rounded-super p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-gray-900">Avis r√©cents</h2>
            <a href="#" class="text-blue-hero font-medium hover:underline text-sm">Voir tous</a>
          </div>
          <div class="space-y-4">
            <div class="border-b border-gray-100 pb-3">
              <div class="flex items-center justify-between mb-1">
                <span class="font-medium text-gray-900">Sophie L.</span>
                <span class="text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
              </div>
              <p class="text-sm text-gray-600">"Service impeccable et tr√®s professionnel. Je recommande !"</p>
              <p class="text-xs text-gray-500 mt-1">Il y a 2 jours</p>
            </div>
          </div>
        </div>
        <% end %>

        <!-- My Profile -->
        <div class="bg-white rounded-super p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-gray-900">Mon profil pro</h2>
            <%= link_to edit_professional_profile_path, class: "text-blue-hero font-medium hover:underline text-sm" do %>
              Modifier
            <% end %>
          </div>
          <div class="space-y-3">
            <div class="flex items-center space-x-3">
              <div class="w-12 h-12 bg-blue-hero rounded-full flex items-center justify-center overflow-hidden flex-shrink-0">
                <% if current_user.profile_photo.attached? %>
                  <%= image_tag current_user.profile_photo, class: "w-full h-full object-cover" %>
                <% else %>
                  <span class="text-white text-xl font-bold"><%= current_user.get_initials %></span>
                <% end %>
              </div>
              <div>
                <p class="font-medium text-gray-900"><%= current_user.get_full_name %></p>
                <% if current_user.email.present? %>
                  <p class="text-xs text-gray-500"><%= current_user.email %></p>
                <% end %>
              </div>
            </div>
            <div class="pt-3 border-t border-gray-100 space-y-2">
              <% if current_user.location.present? %>
                <p class="text-sm text-gray-600">üìç <%= current_user.location %></p>
              <% end %>
              <% if current_user.phone_number.present? %>
                <p class="text-sm text-gray-600">üìû <%= current_user.phone_number %></p>
              <% end %>
              <% if current_user.company_name.present? %>
                <p class="text-sm text-gray-600">üè¢ <%= current_user.company_name %></p>
              <% end %>
              <% if current_user.specialties.any? %>
                <p class="text-sm text-gray-600">
                  üîß <%= current_user.specialties.order(:name).pluck(:name).join(', ') %>
                </p>
              <% end %>
              <% if current_user.active? %>
                <p class="text-sm text-gray-600">‚úì Certifi√© professionnel</p>
              <% end %>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
