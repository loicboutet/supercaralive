<div class="container mx-auto px-6 py-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-4xl font-bold text-gray-900 mb-2">Mes R√©servations</h1>
      <p class="text-gray-600">Consultez vos r√©servations en cours et pass√©es</p>
    </div>
    <%= link_to new_client_booking_path, class: "bg-red-hero hover:bg-red-dark text-white px-6 py-3 rounded-lg font-bold inline-flex items-center w-full md:w-auto justify-center" do %>
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      Nouvelle r√©servation
    <% end %>
  </div>

  <!-- Filters -->
  <div class="mb-6">
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-8">
        <%= link_to client_bookings_path(status: nil), 
            class: "border-b-2 #{params[:status].blank? ? 'border-red-hero text-red-hero' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} py-4 px-1 text-sm font-medium" do %>
          Toutes
        <% end %>
        <%= link_to client_bookings_path(status: 'pending'), 
            class: "border-b-2 #{params[:status] == 'pending' ? 'border-red-hero text-red-hero' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} py-4 px-1 text-sm font-medium" do %>
          En attente
        <% end %>
        <%= link_to client_bookings_path(status: 'accepted'), 
            class: "border-b-2 #{params[:status] == 'accepted' ? 'border-red-hero text-red-hero' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} py-4 px-1 text-sm font-medium" do %>
          Valid√©es
        <% end %>
        <%= link_to client_bookings_path(status: 'refused'), 
            class: "border-b-2 #{params[:status] == 'refused' ? 'border-red-hero text-red-hero' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} py-4 px-1 text-sm font-medium" do %>
          Refus√©es
        <% end %>
        <%= link_to client_bookings_path(status: 'cancelled'), 
            class: "border-b-2 #{params[:status] == 'cancelled' ? 'border-red-hero text-red-hero' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} py-4 px-1 text-sm font-medium" do %>
          Annul√©es
        <% end %>
        <%= link_to client_bookings_path(status: 'completed'), 
            class: "border-b-2 #{params[:status] == 'completed' ? 'border-red-hero text-red-hero' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} py-4 px-1 text-sm font-medium" do %>
          Termin√©es
        <% end %>
      </nav>
    </div>
  </div>

  <% if @bookings&.any? %>
    <div class="space-y-4">
      <% @bookings.each do |booking| %>
        <div class="bg-white rounded-super p-6 shadow-sm hover:shadow-md transition">
          <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4">
            <div class="flex items-start space-x-4 flex-1">
              <% 
                # Color based on status
                status_config = {
                  'pending' => { bg: 'bg-yellow-hero', badge_bg: 'bg-yellow-100', badge_text: 'text-yellow-800' },
                  'accepted' => { bg: 'bg-blue-hero', badge_bg: 'bg-blue-100', badge_text: 'text-blue-800' },
                  'refused' => { bg: 'bg-red-hero', badge_bg: 'bg-red-100', badge_text: 'text-red-800' },
                  'cancelled' => { bg: 'bg-gray-500', badge_bg: 'bg-gray-100', badge_text: 'text-gray-800' },
                  'completed' => { bg: 'bg-green-500', badge_bg: 'bg-green-100', badge_text: 'text-green-800' }
                }
                status_config_default = { bg: 'bg-gray-500', badge_bg: 'bg-gray-100', badge_text: 'text-gray-800' }
                status_style = status_config[booking.status] || status_config_default
                status_labels = {
                  'pending' => 'En attente',
                  'accepted' => 'Valid√©e',
                  'refused' => 'Refus√©e',
                  'cancelled' => 'Annul√©e',
                  'completed' => 'Termin√©e'
                }
                status_label = status_labels[booking.status] || booking.status
              %>
              <div class="w-16 h-16 <%= status_style[:bg] %> rounded-lg flex items-center justify-center flex-shrink-0">
                <span class="text-white text-2xl">
                  <%= booking.status == 'completed' ? '‚úì' : 'üìÖ' %>
                </span>
              </div>
              <div class="flex-1">
                <div class="flex flex-wrap items-center gap-2 mb-1">
                  <h3 class="text-xl font-bold text-gray-900"><%= booking.service_type_name %></h3>
                  <span class="px-3 py-1 rounded-lg text-xs font-medium <%= status_style[:badge_bg] %> <%= status_style[:badge_text] %>">
                    <%= status_label %>
                  </span>
                </div>
                <p class="text-gray-600 mb-2"><strong>Professionnel:</strong> <%= booking.professional_name %></p>
                <div class="flex flex-wrap items-center text-sm text-gray-500 gap-4">
                  <span class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <%= booking.scheduled_at&.strftime("%d/%m/%Y √† %H:%M") %>
                  </span>
                  <% if booking.vehicle_model.present? %>
                    <span class="flex items-center">
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      <%= booking.vehicle_model %>
                    </span>
                  <% end %>
                </div>
              </div>
            </div>
            <div class="text-left md:text-right">
              <% if booking.estimated_price.present? %>
                <p class="text-2xl font-bold text-gray-900"><%= number_to_currency(booking.estimated_price, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") %></p>
                <p class="text-xs text-gray-500">Prix estim√©</p>
              <% else %>
                <p class="text-sm text-gray-500">Prix √† d√©finir</p>
              <% end %>
            </div>
          </div>

          <% if booking.description.present? %>
            <div class="mb-4 p-4 bg-soft rounded-lg">
              <p class="text-sm text-gray-600"><strong>Description:</strong> <%= booking.description %></p>
            </div>
          <% end %>

          <!-- Reviews section - Hidden for now -->
          <div style="display: none;">
            <% if booking.status == 'completed' && booking.reviewed? %>
              <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-500 rounded-lg">
                <div class="flex items-start justify-between mb-2">
                  <h4 class="font-bold text-green-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Votre avis
                  </h4>
                </div>
              </div>
            <% end %>
          </div>

          <div class="flex flex-col sm:flex-row gap-2 pt-4 border-t border-gray-200">
            <% if booking.chat.present? %>
              <%= link_to "#{client_booking_path(booking.id)}#messages_container", class: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium text-sm inline-flex items-center justify-center" do %>
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                Envoyer message
              <% end %>
            <% end %>
            <%= link_to client_booking_path(booking.id), class: "bg-blue-hero hover:bg-blue-dark text-white px-4 py-2 rounded-lg font-medium text-sm inline-flex items-center justify-center" do %>
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
              Voir d√©tails
            <% end %>
            <% if booking.pending? || booking.accepted? %>
              <%= link_to edit_client_booking_path(booking.id), class: "bg-yellow-hero hover:bg-opacity-90 text-white px-4 py-2 rounded-lg font-medium text-sm inline-flex items-center justify-center" do %>
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Modifier
              <% end %>
              <% if booking.pending? %>
                <%= button_to cancel_client_booking_path(booking.id), method: :patch, data: { turbo: false, confirm: "√ätes-vous s√ªr de vouloir annuler cette r√©servation ?" }, class: "bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium text-sm inline-flex items-center justify-center" do %>
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                  Annuler
                <% end %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Pagination -->
    <% if @pagy.present? && @pagy.pages > 1 %>
      <div class="mt-8">
        <%= pagy_nav_supercaralive(@pagy, params: request.query_parameters) %>
      </div>
    <% end %>
  <% else %>
    <div class="bg-soft rounded-super p-12 text-center">
      <div class="w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center mx-auto mb-4">
        <span class="text-4xl">üìÖ</span>
      </div>
      <h3 class="text-2xl font-bold text-gray-900 mb-2">Aucune r√©servation</h3>
      <p class="text-gray-600">
        <% if params[:status].present? %>
          Vous n'avez pas de r√©servation avec ce statut.
        <% else %>
          Vous n'avez pas encore de r√©servation. Trouvez un professionnel et r√©servez votre premier service !
        <% end %>
      </p>
    </div>
  <% end %>
</div>
